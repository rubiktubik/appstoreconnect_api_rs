/*
 * App Store Connect API
 *
 * No description provided (generated by Openapi Generator https://github.com/openapitools/openapi-generator)
 *
 * The version of the OpenAPI document: 3.6.0
 *
 * Generated by: https://openapi-generator.tech
 */

use anyhow::Result;
use std::path::PathBuf;

use crate::models::jwt::generate_jwt;

#[derive(Debug, Clone, Default)]
pub struct Configuration {
    pub base_path: String,
    pub user_agent: Option<String>,
    pub client: reqwest::Client,
    pub bearer_access_token: Option<String>,
}

impl Configuration {
    pub fn new(
        key_id: String,
        issuer_id: String,
        private_key_path: PathBuf,
    ) -> Result<Configuration> {
        let config = Configuration {
            base_path: "https://api.appstoreconnect.apple.com".to_owned(),
            user_agent: Some("OpenAPI-Generator/3.6.0/rust".to_owned()),
            client: reqwest::Client::new(),
            bearer_access_token: Some(generate_jwt(&key_id, &issuer_id, private_key_path)?),
        };
        Ok(config)
    }
    pub fn from_existing_jwt(jwt: String) -> Result<Configuration> {
        let config = Configuration {
            base_path: "https://api.appstoreconnect.apple.com".to_owned(),
            user_agent: Some("OpenAPI-Generator/3.6.0/rust".to_owned()),
            client: reqwest::Client::new(),
            bearer_access_token: Some(jwt),
        };
        Ok(config)
    }
}
